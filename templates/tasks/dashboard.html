{% extends "base.html" %}

{% block title %}Your Tasks{% endblock %}

{% block content %}
  <h2 class="text-xl font-bold mb-4">Your Tasks</h2>
  <a href="{% url 'create_task' %}"
   class="inline-block mb-4 px-4 py-2 bg-white text-black rounded-lg hover:bg-white/80 transition">
    + New Task
  </a>

  <!-- live search -->

    <div class="mb-4">
        <input
          id="search-input"
          type="text"
          placeholder="Search by titleâ€¦"
          class="w-full px-3 py-2 bg-white bg-opacity-10 text-white placeholder-white/70 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-white/30 transition"
        />
    </div>

  {% if tasks %}
   <ul id="tasks-list" class="space-y-4">
      {% for t in tasks %}
        <li class="bg-white/10 border border-white/20 rounded-lg p-4">
          <div class="flex justify-between items-center">
            <h3 class="font-semibold">{{ t.title }}</h3>
            <div class="flex space-x-2">
              <a href="{% url 'edit_task' t.pk %}"
                 class="px-3 py-1 bg-white text-black rounded hover:bg-white/80 text-sm">
                Edit
              </a>
              <a href="{% url 'delete_task' t.pk %}"
                 class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                Delete
              </a>
            </div>
          </div>
          <p class="text-sm mt-2">On {{ t.date }} at {{ t.approx_time }}</p>
          {% if t.email %}<p class="text-sm">Email: {{ t.email }}</p>{% endif %}
          {% if t.description %}<p class="mt-2">{{ t.description }}</p>{% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No tasks yet.</p>
  {% endif %}

    <!-- client-side filtering -->
  <script>
    (function(){
      const input = document.getElementById("search-input");
      const items = Array.from(document.querySelectorAll("#tasks-list li"));

      input.addEventListener("input", () => {
        const q = input.value.trim().toLowerCase();
        // if empty => show all
        if (!q) {
          items.forEach(li => li.style.display = "");
          return;
        }
        // otherwise show only matching
        items.forEach(li => {
          const title = li.querySelector("h3").textContent.toLowerCase();
          li.style.display = title.includes(q) ? "" : "none";
        });
      });
    })();
  </script>
{% endblock %}
